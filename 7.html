<!-- שמור כקובץ HTML -->
<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>זריחה ושקיעה</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <style>
    body {
      font-family: "David", sans-serif;
      font-weight: bold;
      background-color: #f8f3e8;
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: relative;
      direction: rtl;
    }

    #wrapper {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #current-time-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 2;
    }

    #current-time {
      font-size: 378px;
      direction: ltr;
    }

    #current-time .regular-seconds {
      font-size: 50%;
      color: red;
    }

    .label {
      font-family: 'Guttman-Aram', serif;
      color: #5e1300;
      font-size: 68px;
      margin-top: 10px;
    }

    .title {
      font-family: 'Guttman-Aram', serif;
      color: black;
      font-size: 40px;
      margin-top: 10px;
    }

    .top-right, .top-left, .bottom-right, .bottom-left {
      position: absolute;
      text-align: right;
      z-index: 3;
    }

    .top-right { top: 20px; right: 20px; }
    .top-left { top: 20px; left: 20px; text-align: left; }
    .bottom-right { bottom: 20px; right: 20px; text-align: right; }
    .bottom-left { bottom: 20px; left: 20px; text-align: left; }
	
	.countdown-box {
	  text-align: center;
	}

	.countdown-netz {
	  font-size: 200px;
	  color: blue;
	}

	.countdown-sunset {
	  font-size: 200px;
	  color: orange;
	}


    .countdown-title {
      font-size: 40px;
    }

    #countdown {
      font-size: 250px;
      color: green;
    }

    .clock {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 130%;
      opacity: 0.3;
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <canvas id="clock" class="clock"></canvas>

    <div id="current-time-container">
      <span id="current-time">--:--:--</span>
    </div>
	
	<div id="omer-count" class="label"></div>


<div id="top-right">
  <span class="label" id="dateHeb"></span>
  <span class="label" id="current-date"></span><br>
  <span class="title">פרשת השבוע </span>
  <span class="label" id="parashaName"></span>
  <span class="label" id="omer-count"></span>
</div>


    <div class="top-left">
      <span class="title">הדף היומי </span>
      <span class="label" id="dailyDaf"></span>
    </div>

    <!-- צד ימין - זריחה -->
    <div class="bottom-right">
      <div>
        <div><span class="title">זמן נץ החמה </span>
          <span class="label" id="sunrise-time">--:--</span></div>
        <div><span class="title">ספירה לזריחה</span></div>
        <div id="countdown-netz" class="countdown-netz"></div>
      </div>
    </div>

    <!-- צד שמאל - שקיעה -->
    <div class="bottom-left">
      <div>
        <div><span class="title">שקיעה היום </span>
          <span class="label" id="sunset-time">--:--</span></div>
        <div><span class="title">ספירה לשקיעה</span></div>
        <div id="countdown-sunset" class="countdown-sunset"></div>
      </div>
    </div>
  </div>

  <!--Suiss-clock-->
<script>
	(function(){
	var canvas = document.getElementById('clock');

	var Clock = function(canvas, radius) {
		this.canvas = canvas;
		this.ctx = this.canvas.getContext('2d');

		this.secondHandOptions = {
			color: '#cd151c',
			thicknessRatio: 0.0075,
			forwardRadiusRatio: 0.75,
			backwardRadiusRatio: 0.25,
			tipRadiusRatio: 0.075
		}

		this.minuteHandOptions = {
			color: '#000',
			thicknessRatio: 0.06,
			forwardRadiusRatio: 0.875,
			backwardRadiusRatio: 0.25
		}

		this.hourHandOptions = {
			color: '#000',
			thicknessRatio: 0.08,
			forwardRadiusRatio: 0.6,
			backwardRadiusRatio: 0.25
		}

		this.markerOptions = {
			color: '#000',
			edgeDistanceRatio: 0.05,
			thicknessRatio: 0.01,
			lengthRatio: 0.1,
			keyMarkers: 5,
			keyMarkerThicknessRatio: 0.075,
			keyMarkerLengthRatio: 0.2
		}

		this.radius = radius;

		this.update();
	};

	Clock.prototype.update = function() {
    this.center = {
      x: this.canvas.width * 0.5,
      y: this.canvas.height * 0.5
    }

		this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
		this.drawFace();
		this.drawMinuteMarkers();
		this.drawHourHand();
		this.drawMinuteHand();
		this.drawSecondHand();
		this.drawPin();
	};

	Clock.prototype.drawFace = function() {
		var faceGradient = this.ctx.createRadialGradient(this.center.x, this.center.y, 0, this.center.x, this.center.y, this.radius);
		faceGradient.addColorStop(0, "rgba(255, 231, 180, 0)");
		faceGradient.addColorStop(1, "rgba(182, 157, 100, 0.3)");
		this.ctx.fillStyle=faceGradient;

		this.ctx.beginPath();
		this.ctx.arc(this.center.x, this.center.y, this.radius, 0, 2 * Math.PI);

		this.ctx.fillStyle='#fff';
		this.ctx.fill();
		this.ctx.fillStyle=faceGradient;
		this.ctx.fill();

		var edgeGradient = this.ctx.createLinearGradient(0, this.center.y - this.radius, 0, this.center.y + this.radius);
		edgeGradient.addColorStop(0, "#999");
		edgeGradient.addColorStop(0.5, "#fff");
		edgeGradient.addColorStop(1, "#999");
		this.ctx.fillStyle=edgeGradient;

		this.ctx.beginPath();
		this.ctx.arc(this.center.x, this.center.y, this.radius, 0, 2 * Math.PI);
		
		this.ctx.closePath();
		this.ctx.arc(this.center.x, this.center.y, this.radius + (this.radius * 0.075), 0, 2 * Math.PI, true);

		this.ctx.shadowColor = 'rgba(0,0,0,0.7)';
		this.ctx.shadowBlur = this.radius * 0.3;
		this.ctx.shadowOffsetY = 1;
		this.ctx.fill();
		this.ctx.shadowBlur = 0;
		this.ctx.shadowOffsetY = 0;
	};

	Clock.prototype.drawPin = function() {
		this.ctx.fillStyle='#999';
		this.ctx.beginPath();
		this.ctx.arc(this.center.x, this.center.y, 4, 0, 2 * Math.PI);
		this.ctx.fill();
	};

	Clock.prototype.drawMinuteMarkers = function() {
		var i = 1;
		while (i <= 60) {
			var angle = (Math.PI * 2) * (-i / 60);

			var startX = (Math.sin(angle) * (this.radius - (this.radius * this.markerOptions.edgeDistanceRatio))) + this.center.x;
			var startY = (Math.cos(angle) * (this.radius - (this.radius * this.markerOptions.edgeDistanceRatio))) + this.center.y;

			if (i % this.markerOptions.keyMarkers) {
				var endX = (Math.sin(angle) * (this.radius - (this.radius * this.markerOptions.lengthRatio) - (this.radius * this.markerOptions.edgeDistanceRatio))) + this.center.x;
				var endY = (Math.cos(angle) * (this.radius - (this.radius * this.markerOptions.lengthRatio) - (this.radius * this.markerOptions.edgeDistanceRatio))) + this.center.y;
				this.ctx.lineWidth = this.markerOptions.thicknessRatio * this.radius;
			} else {
				var endX = (Math.sin(angle) * (this.radius - (this.markerOptions.keyMarkerLengthRatio * this.radius) - (this.radius * this.markerOptions.edgeDistanceRatio))) + this.center.x;
				var endY = (Math.cos(angle) * (this.radius - (this.markerOptions.keyMarkerLengthRatio * this.radius) - (this.radius * this.markerOptions.edgeDistanceRatio))) + this.center.y;
				this.ctx.lineWidth = this.markerOptions.keyMarkerThicknessRatio * this.radius;
			}

			this.ctx.strokeStyle = this.markerOptions.color;

			this.ctx.beginPath();
			this.ctx.moveTo(startX, startY);
			this.ctx.lineTo(endX, endY);
			this.ctx.stroke();

			i++;
		}
	};

Clock.prototype.drawSecondHand = function() {
    var milliseconds = ((Date.now() + (3 * 60 * 60 * 1000)) / 1000) % 60;
    var handAngle = Math.max(-Math.PI * 2, (Math.PI * 2) * (-milliseconds / 58.5));

    this.drawHand(handAngle, this.secondHandOptions);
};

Clock.prototype.drawMinuteHand = function() {
    var minutes = Math.floor(((Date.now() + (3 * 60 * 60 * 1000)) / 60000) % 60);
    var handAngle = (Math.PI * 2) * (-minutes / 60);

    this.drawHand(handAngle, this.minuteHandOptions);
};

<!--שעון חורף 2, שעון קיץ 3-->
Clock.prototype.drawHourHand = function() {
    var hours = ((Date.now() + (3 * 60 * 60 * 1000)) / 3600000) % 12;
    var handAngle = (Math.PI * 2) * (-hours / 12);

    this.drawHand(handAngle, this.hourHandOptions);
};


	Clock.prototype.drawHand = function(angle, handOptions) {
		var startX = (Math.sin(angle) * (this.radius * handOptions.backwardRadiusRatio)) + this.center.x;
		var startY = (Math.cos(angle) * (this.radius * handOptions.backwardRadiusRatio)) + this.center.y;

		var endX = (Math.sin(angle - Math.PI) * (this.radius * handOptions.forwardRadiusRatio)) + this.center.x;
		var endY = (Math.cos(angle - Math.PI) * (this.radius * handOptions.forwardRadiusRatio)) + this.center.y;

		this.ctx.shadowColor = 'rgba(0,0,0,0.8)';
		this.ctx.shadowBlur = this.radius * 0.075;
		this.ctx.shadowOffsetY = 1;

		this.ctx.strokeStyle = handOptions.color;
		this.ctx.lineWidth = handOptions.thicknessRatio * this.radius;

		this.ctx.beginPath();
		this.ctx.moveTo(startX, startY);
		this.ctx.lineTo(endX, endY);
		this.ctx.stroke();

		if (handOptions.tipRadiusRatio) {
			this.ctx.fillStyle = handOptions.color;
			this.ctx.beginPath();
			this.ctx.arc(endX, endY, handOptions.tipRadiusRatio * this.radius, 0, 2 * Math.PI);
			this.ctx.fill();
		}

		this.ctx.shadowBlur = 0;
		this.ctx.shadowOffsetY = 0;

		if (handOptions.tipRadiusRatio) {
			this.ctx.beginPath();
			this.ctx.moveTo(startX, startY);
			this.ctx.lineTo(endX, endY);
			this.ctx.stroke();
		}
	};

	sizeCanvas();

	var clock = new Clock(canvas, clockRadius());

	function clockRadius() {
		return Math.min(window.innerWidth, window.innerHeight) * 0.70;
	}

	function sizeCanvas() {
		canvas.width = window.innerWidth * 2;
		canvas.height = window.innerHeight * 2;
	}

	function render() {
		clock.update();
		requestAnimationFrame(render);
	}

	render();

	var lastWidth = window.innerWidth;

	window.addEventListener('resize', function(e){
		if (window.innerWidth != lastWidth) {
			clock.radius = clockRadius();
			lastWidth = window.innerWidth;
			sizeCanvas();
		}
	});
})();
//clock.update();
</script>
<!--ספירת העומר-->
<!--script>
function getOmerCount(date = new Date()) {
  const pesachStart = new Date(date.getFullYear(), 3, 23); // ניסן ט"ו, התאריך הלועזי בערך באפריל 23 (שנה רגילה)
  const dayMs = 24 * 60 * 60 * 1000;
  const omerStart = pesachStart.getTime() + dayMs; // מתחילים לספור בערב שני של פסח
  const now = date.getTime();

  const diffDays = Math.floor((now - omerStart) / dayMs) + 1;

  if (diffDays < 1 || diffDays > 49) return ''; // מחוץ לתחום הספירה

  const weeks = Math.floor(diffDays / 7);
  const days = diffDays % 7;

  let hebrewCount = `היום ${convertToHebrewNumber(diffDays)} יום`;
  if (weeks > 0 || days > 0) {
    hebrewCount += ` שהם `;
    if (weeks > 0) {
      hebrewCount += `${convertToHebrewNumber(weeks)} שבוע`;
      if (weeks !== 1) hebrewCount += 'ות';
      if (days > 0) hebrewCount += ' ו';
    }
    if (days > 0) {
      hebrewCount += `${convertToHebrewNumber(days)} יום`;
    }
  }

  hebrewCount += ' בעומר';

  return hebrewCount;
}

function convertToHebrewNumber(num) {
  const hebrewDigits = ["", "אחד", "שניים", "שלושה", "ארבעה", "חמישה", "שישה", "שבעה", "שמונה", "תשעה", "עשרה"];
  if (num <= 10) return hebrewDigits[num];
  if (num < 20) return "עשרה ו" + hebrewDigits[num - 10];
  if (num < 30) return "עשרים ו" + hebrewDigits[num - 20];
  if (num < 40) return "שלושים ו" + hebrewDigits[num - 30];
  if (num < 50) return "ארבעים ו" + hebrewDigits[num - 40];
  if (num === 49) return "ארבעים ותשעה";
  return num.toString(); // fallback
}

document.addEventListener("DOMContentLoaded", function () {
  const omerText = getOmerCount();
  if (omerText) {
    document.getElementById('omer-count').textContent = omerText;
  }
});
</script-->

<!--הדף היומי-->
<script>
  async function fetchJewishCalendarData() {
    try {
      const response = await fetch('https://www.sefaria.org/api/calendars');
      const data = await response.json();

      // דף יומי
      const dafYomi = data.calendar_items.find(item => item.title?.he === 'דף יומי');
      const masechet = dafYomi?.displayValue?.he || 'לא נמצא דף';
      document.getElementById('dailyDaf').textContent = masechet;

      // תאריך עברי מתוך "תניא יומי"
      const hebrewDateItem = data.calendar_items.find(item => item.title?.he.includes('תניא יומי'));
      const hebrewDate = hebrewDateItem?.displayValue?.he || 'תאריך לא זמין';
      document.getElementById('dateHeb').textContent = hebrewDate;

      // פרשת השבוע
      const parashaItem = data.calendar_items.find(item => item.title?.he === 'פרשת השבוע');
      const parasha = parashaItem?.displayValue?.he || 'לא נמצאה פרשה';
      document.getElementById('parashaName').textContent = parasha;

    } catch (error) {
      console.error('שגיאה בשליפת מידע:', error);
      document.getElementById('dailyDaf').textContent = 'שגיאה';
      document.getElementById('dateHeb').textContent = 'שגיאה';
      document.getElementById('parashaName').textContent = 'שגיאה';
    }
  }

  fetchJewishCalendarData();
</script>


<!--שעון  -  ספירה נץ ושקיעה-->
  <script>
    let mode = 'netz', netzTime, sunsetTime;
    let countdownInterval;

    function updateClock() {
      const now = new Date();
      const hh = now.getHours().toString();
      const mm = now.getMinutes().toString();
      const ss = now.getSeconds().toString().padStart(2, '0');
      $('#current-time').html(`${hh}:${mm}<span class="regular-seconds">:${ss}</span>`);
      $('#current-date').text(`${now.getDate().toString().padStart(2, '0')}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getFullYear()}`);
    }

function startCountdown(target, targetId) {
  clearInterval(countdownInterval);
  countdownInterval = setInterval(() => {
    const now = moment();
    const diff = moment(target).diff(now);
    const $countdownNetz = $('#countdown-netz');
    const $countdownSunset = $('#countdown-sunset');

    // אם יותר מחצי שעה מראש – לא להציג
    if (diff > 30 * 60 * 1000) {
      if (targetId === 'netz') {
        $countdownNetz.text('').css('color', '');
      } else {
        $countdownSunset.text('').css('color', '');
      }
      return;
    }

    // ספירה הגיעה לאפס
    if (diff <= 0) {
      if (targetId === 'netz') {
        $countdownNetz.text('עבר').css('color', '');
      } else {
        $countdownSunset.text('עבר').css('color', '');
      }
      clearInterval(countdownInterval);
      setTimeout(() => {
        if (mode === 'netz') {
          mode = 'sunset';
          startCountdown(sunsetTime, 'sunset');
        } else {
          mode = 'netz';
          fetchZmanim(true);
        }
      }, 5000);
      return;
    }

    const duration = moment.duration(diff);
    const timeStr = `${duration.hours()}:${duration.minutes().toString().padStart(2, '0')}:${duration.seconds().toString().padStart(2, '0')}`;

    if (targetId === 'netz') {
      $countdownNetz.text(timeStr).css('color', diff <= 60 * 1000 ? 'red' : diff <= 2 * 60 * 1000 ? 'orange' : 'blue');
      $countdownSunset.text('');
    } else {
      $countdownSunset.text(timeStr).css('color', diff <= 2 * 60 * 1000 ? 'red' : 'orange');
      $countdownNetz.text('');
    }
  }, 1000);
}


    function fetchZmanim(forTomorrow = false) {
      const date = moment().add(forTomorrow ? 1 : 0, 'days').format('YYYY-MM-DD');
      $.get(`https://api.sunrisesunset.io/json?lat=31.7946859557658&lng=-325.3427267074585&date=${date}&timezone=Asia/Jerusalem`)
        .done(data => {
          const sunrise = `${date} ${data.results.sunrise}`;
          const sunset = `${date} ${data.results.sunset}`;
          netzTime = moment(sunrise, 'YYYY-MM-DD h:mm:ss A');
          sunsetTime = moment(sunset, 'YYYY-MM-DD h:mm:ss A');
          $('#sunrise-time').text(netzTime.format('H:mm:ss'));
          $('#sunset-time').text(sunsetTime.format('H:mm:ss'));

          if (mode === 'netz') {
            startCountdown(netzTime, 'netz');
          } else {
            startCountdown(sunsetTime, 'sunset');
          }
        })
        .fail(() => {
          $('#countdown-netz').text('שגיאת API');
          $('#countdown-sunset').text('שגיאת API');
        });
    }

    $(document).ready(() => {
      updateClock();
      setInterval(updateClock, 1000);
      fetchZmanim();
    });
  </script>
</body>
</html>
